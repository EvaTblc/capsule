<div class="home-banner" data-controller="toggle barcode" data-barcode-intake-url-value="<%= intake_collection_category_items_path(@collection, @category) %>"
    data-barcode-new-url-value="<%= new_collection_category_item_path(@collection, @category) %>">
  <div class="cyber-container">

    <!-- Terminal Header -->
    <div class="terminal-header">
      <div class="terminal-dots">
        <span class="dot red"></span>
        <span class="dot yellow"></span>
        <span class="dot green"></span>
      </div>
      <div class="terminal-title">barcode_scanner.exe</div>
    </div>

    <!-- Collection & Category Title -->
    <h1 class="cyber-page-title glitch-text" data-text="<%= @collection.name %> - <%= @category.name %>"><%= @collection.name %> - <%= @category.name %></h1>

    <!-- Actions cyberpunk -->
    <div class="cyber-actions">
      <%= link_to collection_categories_path, class: "cyber-btn secondary" do %>
        <i class="fas fa-arrow-left"></i>
        Retour
      <% end %>
      <%= link_to collection_path(@collection), turbo_method: :delete, data: { turbo_confirm: "Supprimer cette collection ?" }, class: "cyber-btn danger" do %>
        <i class="fas fa-trash"></i>
        Supprimer Collection
      <% end %>
    </div>

    <!-- Mode Selection Cyberpunk -->
    <div class="cyber-card scan-modes" data-toggle-target="controls">
      <div class="card-title">Scan Mode Selection</div>

      <div class="mode-buttons">
        <button class="cyber-btn primary scan-mode-btn"
                data-toggle-target="checkPossess"
                data-action="click->toggle#toggleCheckbox"
                data-barcode-auto-start="true">
          <i class="fas fa-check-circle"></i>
          <div class="btn-content">
            <span class="btn-title">POSSESS MODE</span>
            <span class="btn-desc"><%= @category.name.singularize %> que je possède</span>
          </div>
        </button>

        <button class="cyber-btn secondary scan-mode-btn"
                data-toggle-target="checkSearch"
                data-action="click->toggle#toggleCheckbox">
          <i class="fas fa-search"></i>
          <div class="btn-content">
            <span class="btn-title">SEARCH MODE</span>
            <span class="btn-desc"><%= @category.name.singularize %> que je recherche</span>
          </div>
        </button>
      </div>
    </div>

    <!-- Recovery Actions (hidden) -->
    <div class="cyber-card recovery-actions d-none" data-toggle-target="oups">
      <div class="card-title" style="color: var(--cyber-yellow);">Recovery Protocol</div>
      <div class="mode-buttons">
        <button class="cyber-btn secondary small d-none" data-toggle-target="oupsFindIt">
          <i class="fas fa-search"></i>
          Recherche manuelle
        </button>
      </div>
    </div>


    <!-- Switch to Search Mode (hidden by default) -->
    <div class="switch-mode d-none" data-toggle-target="switchToSearch">
      <div class="cyber-card">
        <div class="card-title">
          Mode Switcher
          <button class="cyber-btn secondary small switch-mode-btn"
                  data-toggle-target="checkSearch"
                  data-action="click->toggle#switchMode"
                  style="float: right; padding: 4px 8px; font-size: 0.7rem;">
            <i class="fas fa-exchange-alt"></i>
            Switch to SEARCH
          </button>
        </div>
      </div>
    </div>

    <!-- Scanner Interface Cyberpunk -->
    <div class="cyber-card scanner-interface d-none" data-toggle-target="scan">
      <div class="card-title">
        Quantum Barcode Reader
      </div>

      <!-- Debug Output -->
      <div class="terminal-output">
        <p class="terminal-line" data-barcode-target="output">En attente d'initialisation...</p>
      </div>

      <!-- Video Scanner -->
      <div class="scanner-viewport">
        <video data-barcode-target="video" playsinline muted autoplay class="cyber-video"></video>
        <div class="scanner-overlay">
          <div class="scan-line"></div>
          <div class="scan-corners">
            <div class="corner top-left"></div>
            <div class="corner top-right"></div>
            <div class="corner bottom-left"></div>
            <div class="corner bottom-right"></div>
          </div>
        </div>
      </div>

      <!-- Scanner Controls -->
      <div class="scanner-controls">
        <button type="button" class="cyber-btn danger" data-action="click->barcode#stopScan">
          <i class="fas fa-stop"></i>
          Arrêter Scan
        </button>

        <label class="cyber-btn secondary file-scan-btn">
          <i class="fas fa-image"></i>
          Scanner Image
          <input type="file" accept="image/*" capture="environment" data-action="change->barcode#decodeFile" style="display: none;">
        </label>
      </div>

      <!-- Manual Barcode Entry -->
      <div class="manual-entry">
        <div class="terminal-output">
          <p class="terminal-line">$ manual_barcode_input --fallback</p>
          <p class="terminal-line" style="color: var(--cyber-yellow);">// Entrez le code ISBN manuellement</p>
        </div>

        <%= form_with url: intake_collection_category_items_path(@collection, @category),
                    method: :post, local: true, data: { turbo: false }, class: "cyber-form-inline" do %>
          <%= hidden_field_tag :status, "owned", id: "barcode-status-field" %>
          <div class="form-group">
            <%= label_tag :barcode, "Code ISBN/EAN", class: "form-label" %>
            <%= text_field_tag :barcode, nil, placeholder: "9782070368228", class: "cyber-input barcode-input" %>
          </div>
          <div class="form-actions">
            <%= submit_tag "ANALYSER CODE", class: "cyber-btn success" %>
          </div>
        <% end %>
      </div>
    </div>

    <!-- Manual Entry (hidden by default) - Adapté selon la catégorie -->
    <div class="add-books d-none" data-toggle-target="addBook">
      <div class="cyber-card">
        <div class="card-title">
          Manual <%= @category.name.singularize %> Entry
          <button class="cyber-btn primary small switch-mode-btn"
                  data-toggle-target="checkPossess"
                  data-action="click->toggle#switchMode"
                  style="float: right; padding: 4px 8px; font-size: 0.7rem;">
            <i class="fas fa-exchange-alt"></i>
            Switch to POSSESS
          </button>
        </div>
      </div>
      <% case @category.name %>
      <% when "Livre" %>
        <%= render "add_book", collection: @collection, category: @category, item: Item.new %>
      <% when "Jeux Vidéo" %>
        <%= render "add_videogame", collection: @collection, category: @category, item: Item.new %>
      <% when "Film" %>
        <%= render "add_movie", collection: @collection, category: @category, item: Item.new %>
      <% when "Figurine" %>
        <%= render "add_toy", collection: @collection, category: @category, item: Item.new %>
      <% else %>
        <%= render "add_item", collection: @collection, category: @category, item: Item.new %>
      <% end %>
    </div>

    <!-- Manual Search (hidden by default) - Adapté selon la catégorie -->
    <div class="search-books d-none" data-toggle-target="searchBook">
      <div class="cyber-card">
        <div class="card-title">
          Manual <%= @category.name.singularize %> Search
          <button class="cyber-btn secondary small switch-mode-btn"
                  data-toggle-target="checkSearch"
                  data-action="click->toggle#switchMode"
                  style="float: right; padding: 4px 8px; font-size: 0.7rem;">
            <i class="fas fa-exchange-alt"></i>
            Switch to SEARCH
          </button>
        </div>
      </div>
      <% case @category.name %>
      <% when "Livre" %>
        <%= render "search_book", collection: @collection, category: @category, item: Item.new %>
      <% when "Jeux Vidéo" %>
        <%= render "search_videogame", collection: @collection, category: @category, item: Item.new %>
      <% when "Film" %>
        <%= render "search_movie", collection: @collection, category: @category, item: Item.new %>
      <% when "Figurine" %>
        <%= render "search_toy", collection: @collection, category: @category, item: Item.new %>
      <% else %>
        <%= render "search_item", collection: @collection, category: @category, item: Item.new %>
      <% end %>
    </div>

  </div>
</div>
