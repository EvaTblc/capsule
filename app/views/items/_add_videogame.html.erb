<div class="cyber-form" data-controller="image-preview game-search"
     data-game-search-search-url-value="<%= search_game_collection_category_items_path(collection, category) %>">
  <%= form_with model: item,
                url: collection_category_items_path(collection, category),
                scope: :item,
                class: "cyber-form-inner",
                data: { turbo_frame: "_top" } do |f| %>

    <%= f.hidden_field :type, value: "VideoGameItem" %>
    <%= f.hidden_field :source, data: { game_search_target: "sourceField" } %>
    <%= f.hidden_field :source_id, data: { game_search_target: "sourceIdField" } %>
    <%= f.hidden_field :barcode %>
    <%= f.hidden_field :status, value: "owned" %>

    <%= f.file_field :photos,
          multiple: true,
          accept: "image/*",
          class: "hidden",
          data: { image_preview_target: "master" } %>

    <div class="cyber-card photo-scanner">
      <div class="card-title">Image Capture Module</div>
      <div class="scanner-actions">
        <label class="cyber-btn primary photo-btn">
          <i class="fas fa-camera"></i>
          Scanner Cam
          <input type="file" accept="image/*" capture="environment" style="display: none;" data-action="change->image-preview#addFiles">
        </label>
        <label class="cyber-btn secondary photo-btn">
          <i class="fas fa-images"></i>
          Archives
          <input type="file" accept="image/*" multiple style="display: none;" data-action="change->image-preview#addFiles">
        </label>
      </div>
      <div class="preview-grid new-grid" data-image-preview-target="list"></div>
    </div>

    <div class="cyber-card search-section">
      <div class="card-title">üîç Recherche IGDB</div>
      <div class="form-group">
        <label>Rechercher un jeu</label>
        <input type="text"
               class="cyber-input"
               placeholder="Tapez le nom du jeu (ex: Zelda Echoes of Wisdom)"
               data-game-search-target="query"
               data-action="input->game-search#search">
        <small class="form-text text-muted">Tapez au moins 3 caract√®res pour lancer la recherche</small>
      </div>
      <div class="list-group d-none" data-game-search-target="results"></div>
    </div>

    <div class="form-group">
      <%= f.label :name, "Titre du jeu" %>
      <%= f.text_field :name, placeholder: "The_Legend_of_Zelda_BOTW.exe", data: { game_search_target: "nameField" } %>
    </div>

    <div class="cyber-card metadata-section">
      <div class="card-title">Game Metadata Archive</div>
      <div class="metadata-grid">
        <div class="form-group">
          <%= f.label :metadata_platforms, "Plateforme(s)" %>
          <%= text_field_tag "item[metadata][platforms]", item.metadata["platforms"], placeholder: "Nintendo Switch, PS5...", class: "cyber-input", data: { game_search_target: "platformsField" } %>
        </div>
        <div class="form-group">
          <%= f.label :metadata_genres, "Genre(s)" %>
          <%= text_field_tag "item[metadata][genres]", item.metadata["genres"], placeholder: "Action, Adventure, RPG...", class: "cyber-input", data: { game_search_target: "genresField" } %>
        </div>
        <div class="form-group">
          <%= f.label :metadata_release_date, "Date de sortie" %>
          <%= text_field_tag "item[metadata][release_date]", item.metadata["release_date"], placeholder: "2017-03-03", class: "cyber-input", data: { game_search_target: "releaseDateField" } %>
        </div>
      </div>
      <div class="form-group">
        <%= f.label :metadata_summary, "Description" %>
        <%= text_area_tag "item[metadata][summary]", item.metadata["summary"], rows: 6, placeholder: "Description complete du jeu...", class: "cyber-textarea", data: { game_search_target: "summaryField" } %>
      </div>
      <div class="form-group">
        <%= hidden_field_tag "item[metadata][cover_url]", item.metadata["cover_url"], data: { game_search_target: "coverUrlField" } %>
        <% if item.metadata["cover_url"].present? %>
          <label>Cover IGDB</label>
          <img src="<%= item.metadata['cover_url'] %>" alt="Cover" style="max-width: 200px; border-radius: 8px;">
        <% end %>
      </div>
    </div>

    <div class="form-actions" style="text-align: center; margin: 2rem 0;">
      <%= f.submit "ARCHIVER JEU", class: "cyber-btn success submit-book" %>
    </div>
  <% end %>
</div>
