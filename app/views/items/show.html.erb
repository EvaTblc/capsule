<div data-controller="toggle">
  <div class="style-title">
    <h2><%= @item.name %></h2>
    <div class="infos-item">

      <div class="info-pill">
        <i class="fas fa-layer-group"></i>
        <span><%= @item.category.name %></span>
      </div>

      <div class="info-pill" >
        <button class="btn-pill" data-toggle-target="numberCopies" data-action="click->toggle#displayInfosCopies">
          <i class="fas fa-cube"></i>
          <span>x<%= @item.total_copies %></span>
        </button>
      </div>
    </div>
  </div>


  <div class="item-actions">
    <%= link_to "‚Üê Retour", collection_category_items_path(@collection, @category), class: "btn-action" %>
    <%= link_to "‚úèÔ∏è Modifier", edit_collection_category_item_path(@collection, @category, @item), class: "btn-action" %>
    <%= link_to "üóëÔ∏è Supprimer", collection_category_item_path(@collection, @category, @item),
        data: { turbo_method: :delete, turbo_confirm: "Supprimer cet item ?" }, class: "btn-action delete" %>
  </div>

  <!-- Item Copies Section -->
  <div class="d-none" data-toggle-target="displayCopies">
    <% if @item.item_copies.any? %>
      <div class="item-copies-section" style="margin: 20px 0; padding: 15px; background: #f8f9fa; border-radius: 8px;">
        <h3>Mes exemplaires (<%= @item.total_copies %>)</h3>

        <div class="copies-grid" style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px; margin-top: 15px;">
          <% @item.item_copies.each_with_index do |copy, index| %>
            <div class="copy-card" style="background: white; padding: 15px; border-radius: 6px; border: 1px solid #dee2e6;">
              <h4 style="margin: 0 0 10px 0; color: #495057;">Exemplaire #<%= index + 1 %></h4>

              <div class="copy-details">
                <div style="display: flex; align-items: center; margin-bottom: 8px;">
                  <i class="fas fa-star-half-alt" style="width: 20px; color: #6c757d;"></i>
                  <strong>√âtat:</strong>&nbsp;<span style="color: #28a745;"><%= copy.state %></span>
                </div>

                <% if copy.price.present? %>
                  <div style="display: flex; align-items: center; margin-bottom: 8px;">
                    <i class="fas fa-coins" style="width: 20px; color: #6c757d;"></i>
                    <strong>Prix d'achat:</strong>&nbsp;<span><%= number_to_currency(copy.price, unit: "‚Ç¨") %></span>
                  </div>
                <% end %>

                <% if copy.purchase_date.present? %>
                  <div style="display: flex; align-items: center; margin-bottom: 8px;">
                    <i class="fas fa-calendar" style="width: 20px; color: #6c757d;"></i>
                    <strong>Achet√© le:</strong>&nbsp;<span><%= copy.purchase_date.strftime("%d/%m/%Y") %></span>
                  </div>
                <% end %>

                <% if copy.notes.present? %>
                  <div style="display: flex; align-items: flex-start; margin-bottom: 8px;">
                    <i class="fas fa-sticky-note" style="width: 20px; color: #6c757d; margin-top: 2px;"></i>
                    <div>
                      <strong>Notes:</strong><br>
                      <span style="font-style: italic; color: #6c757d;"><%= copy.notes %></span>
                    </div>
                  </div>
                <% end %>
              </div>
            </div>
          <% end %>
        </div>
      </div>
    <% end %>
  </div>

  <div data-controller="photo-modal">
    <% photos = @item.photos.to_a %>

    <% if photos.any? %>
      <!-- Premi√®re photo en grand -->
      <div class="photo-hero">
        <%= cl_image_tag photos.first.key,
              alt: @item.name,
              class: "photo-hero-img",
              data: {
                action: "click->photo-modal#show",
                photo_modal_url_value: cl_image_path(photos.first.key)
              } %>
      </div>

      <!-- Galerie avec le reste -->
      <% if photos.many? %>
        <div class="photo-gallery">
          <% photos.drop(1).each do |photo| %>
            <%= cl_image_tag photo.key,
                  alt: @item.name,
                  class: "photo-gallery-thumb",
                  data: {
                    action: "click->photo-modal#show",
                    photo_modal_url_value: cl_image_path(photo.key)
                  } %>
          <% end %>
        </div>
      <% end %>
    <% end %>

    <!-- Modal -->
    <div data-photo-modal-target="overlay" class="modal hidden">
      <div class="modal-content">
        <img data-photo-modal-target="image" src="" alt="Photo agrandie">
        <button data-action="click->photo-modal#hide" class="modal-close">Fermer</button>
      </div>
    </div>
  </div>

  <% if @item.metadata.present? %>
    <p><strong><i class="fa-solid fa-book-open"></i></strong> <%= @item.metadata["description"] %></p>
    <p><strong><i class="fa-solid fa-users"></i></strong> <%= @item.metadata["authors"] %></p>
    <p><strong><i class="fa-solid fa-square-pen"></i></strong> <%= @item.metadata["publisher"] %></p>
    <p><strong><i class="fa-solid fa-language"></i></strong> <%= format_language(@item.metadata["language"]) %></p>
    <% raw_date = @item.metadata["published_date"] %>
    <p><strong><i class="fa-solid fa-calendar"></i></strong> <%= Date.parse(raw_date).strftime("%d-%m-%Y") rescue raw_date %></p>
  <% end %>
</div>
